@inject ogloszenia.Services.ILocalizationService Localizer
@{
    ViewData["Title"] = Localizer.Get("AdvancedSearchTitle");
}

<div class="container mt-4">
    <h1>@Localizer.Get("AdvancedSearch")</h1>

    <div class="card">
        <div class="card-body">
            <form method="post" asp-action="AdvancedSearch">
                <div class="mb-3">
                    <label for="categoryId" class="form-label">@Localizer.Get("SelectCategory")</label>
                    <select class="form-select" id="categoryId" name="categoryId" onchange="this.form.submit()">
                        <option value="">-- @Localizer.Get("SelectCategory") --</option>
                        @if (ViewBag.Categories != null)
                        {
                            foreach (var category in ViewBag.Categories)
                            {
                                <option value="@category.Id" selected="@(ViewBag.SelectedCategory?.Id == category.Id)">
                                    @category.Name
                                </option>
                            }
                        }
                    </select>
                </div>

                @if (ViewBag.SelectedCategory != null)
                {
                    var category = ViewBag.SelectedCategory as ogloszenia.Models.Category;
                    
                    <h5 class="mt-4">@Localizer.Get("CategoryAttributes"): @category.Name</h5>
                    
                    @if (category.Attributes != null && category.Attributes.Any())
                    {
                        foreach (var attr in category.Attributes)
                        {
                            <div class="mb-3">
                                <label for="attr_@attr.Id" class="form-label">@attr.Name</label>
                                
                                @if (attr.AttributeType == "shorttext")
                                {
                                    <input type="text" class="form-control" id="attr_@attr.Id" name="criteria[attr_@attr.Id]" />
                                }
                                else if (attr.AttributeType == "longtext")
                                {
                                    <textarea class="form-control" id="attr_@attr.Id" name="criteria[attr_@attr.Id]" rows="3"></textarea>
                                }
                                else if (attr.AttributeType == "int")
                                {
                                    <input type="number" class="form-control" id="attr_@attr.Id" name="criteria[attr_@attr.Id]" />
                                }
                                else if (attr.AttributeType == "real")
                                {
                                    <input type="number" step="0.01" class="form-control" id="attr_@attr.Id" name="criteria[attr_@attr.Id]" />
                                }
                                else if (attr.AttributeType == "bool")
                                {
                                    <select class="form-select" id="attr_@attr.Id" name="criteria[attr_@attr.Id]">
                                        <option value="">-- @Localizer.Get("Any") --</option>
                                        <option value="true">@Localizer.Get("Yes")</option>
                                        <option value="false">@Localizer.Get("No")</option>
                                    </select>
                                }
                                else if (attr.AttributeType == "dictionary" && attr.Dictionary != null)
                                {
                                    <select class="form-select" id="attr_@attr.Id" name="criteria[attr_@attr.Id]">
                                        <option value="">-- @Localizer.Get("Select") --</option>
                                        @if (attr.Dictionary.Values != null)
                                        {
                                            foreach (var val in attr.Dictionary.Values)
                                            {
                                                <option value="@val.Value">@val.Value</option>
                                            }
                                        }
                                    </select>
                                }
                                
                                @if (!string.IsNullOrEmpty(attr.Description))
                                {
                                    <small class="form-text text-muted">@attr.Description</small>
                                }
                            </div>
                        }
                        
                        <button type="submit" class="btn btn-primary">@Localizer.Get("Search")</button>
                        <a href="/Advertisement/Index" class="btn btn-secondary">@Localizer.Get("Cancel")</a>
                    }
                    else
                    {
                        <div class="alert alert-info">
                            @Localizer.Get("NoCategoryAttributes")
                        </div>
                    }
                }
                else
                {
                    <div class="alert alert-info">
                        @Localizer.Get("SelectCategoryToSeeFilters")
                    </div>
                }
            </form>
        </div>
    </div>

    <div class="mt-3">
        <a href="/Advertisement/Search" class="btn btn-link">@Localizer.Get("BackToBasicSearch")</a>
    </div>
</div>
